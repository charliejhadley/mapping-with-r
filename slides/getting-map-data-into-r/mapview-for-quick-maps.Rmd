---
title: "{mapview} for quick maps"
output:
  xaringan::moon_reader:
    css: ["style.css", "default"]
    lib_dir: libs
    df_print: paged
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:9
editor_options: 
  chunk_output_type: console
---

class: center, middle, dk-section-title
background-image:url("images/mapview-logo.gif")
background-size: 400px

# {mapview} for quick maps

???

Geospatial data is very different from rectangular datasets you might find in Excel files, it's often impossible to really understand your geospatial datasets before you've taken a look at them.

That's why I'm going to introduce you to the mapview package before we get bogged down with anything else.

---

## {mapview} is built for quick dataviz

With {ggplot2} we can build print quality static maps.

With {leaflet} we can build rich, interactive maps.

With {mapview} we can check if our data makes sense.

???

The mapview package is designed exclusively for quick and dirty visualisations to check that our data makes sense. We would never use it for creating maps that we wanted others to see, that's what {ggplot2} and {leaflet} are for which have their own dedicated chapters in this coure.

Let's go into RStudio and demonstrate how the package works.

---

## (RStudio Coding Slide)

???

[Switch to RStudio with the following packages loaded] 

library("mapview")
library("rnaturalearthdata")
library("albersusa")
library("stars")

satellite_image <- system.file("tif/L7_ETMs.tif", package = "stars")

I've loaded the mapview package so we can show it works and I've also loaded two packages that contain geospatial datasets:

- rnaturalearthdata is my favourite source of country shapefiles for the whole world, and we'll be using it often during the course.

- alberusa contains the same manipulated map of the USA that I showed in the previous section, where Alaska and Hawaii are tucked below the contiguous states.

- the final package I've loaded is called stars, which is used for working with raster geospatial data. There's also one pre-written line of code to correctly load in a stars compatible dataset.

Let's load these packages and load in our satellite_image dataset.

I want to get the country shapefiles first, so let's do that... 

countries110

if I print the object to the console we can see it's something called a SpatialPolygonsDataFrame... we don't really need to care about that means right now, we know it's a spatial dataset - so let's throw it into mapview()

mapview(countries110)

And immediately we get an interactive map that verifies we're looking at country borders! If I click on, say Russia the mapview chart will show me all of the information about that country (or more technically, the polygon).

Okay! Now let's look at a different dataset from the same rnaturaldata package:

tiny_countries110

This is a different kind of thing called a SpatialPointsDataFrame... but we can give it to mapview all the same:

mapview(tiny_countries110)

Mapview knows exactly what to do, we get points! Again I can click on one, for instance "Comoros"... a good question is - why are these points instead of polygons? Well, they're smaller than the highest resolution of shapefiles available from rnaturalearthdata - so the best they can do is place a circle at the centre of the shape.

... now most of the time that we'll use mapview in the course we'll be using the pipe, let's demonstrate that with the usa_sf() object [see it's a different kind of dataset]

usa_sf() %>% mapview()

But, unfortunately the {mapview} package doesn't include a definition of the pipe. There's lots of packages that do load in the pipe, but I'm going to choose to load the tidyverse as that's where we'll usually get the pipe later in the course.

library("tidyverse")

Okay! Before we re-run our pipe, let's show that we can make mapview more useful by colouring our choropleth by a variable:

usa_sf() %>% 
  mapview(zcol = "pop_2014", legend = TRUE)
  
Great! We've seen that mapview can be used to quickly visualise polygons and points, but it's also clever enough to work with raster datasets.

We need to load in the dataset and provide it to mapview()

satellite_image %>%
  read_stars() %>%
  mapview()
  
And we get back a satellite map!

There is only one more thing I want to show you about mapview, and that's how we can view multiple datasets at once: we provide a list in the first argument!

mapview(list(tiny_countries110, countries110))

---

## mapview features

.pull-left[
- Designed to be fast

- Works with all geospatial data packages

  - `{sp}`
  - `{sf}`
  - `{stars}`
  
- Can be further customised, see package website for more details: <br>[r-spatial.github.io/mapview](http://r-spatial.github.io/mapview)
]

.pull-right[
```{r, eval=TRUE, echo=FALSE, out.width="450px", out.height="450px"}
mapview(franconia, color = "cyan", col.regions = "white", lwd = 3)
```

]

???

... and that's the mapview package in a nutshell. It's extremely useful because it's designed to be fast, and it works with all of the geospatial data packages that we're going to use in the course.

This covers absolutely everything that I do with the mapview package, if you're interested in customising its maps a little more then check out the package website for examples and resources.

